---
title: "tidy_author"
author: "Dewi Amaliah"
date: "24/10/2021"
output: html_document
---

```{r setup, include=FALSE}
knitr::opts_chunk$set(echo = TRUE)
library(tidyverse)
library(qdapRegex)
library(entity)
```

```{r}
url <- "http://cran.rstudio.com/web/packages/packages.rds"
db <- readRDS(url(url)) %>% 
  as.data.frame()

ctvs <- map_dfr(ctv::available.views(repos = "http://cran.rstudio.com/"), 
                  ~tibble(name = .x[["name"]],
                          topic = .x[["topic"]],
                          pkgs = map(name, ~ctv:::.get_pkgs_from_ctv_or_repos(.x, 
                                                repos = "http://cran.rstudio.com/")[[1]])))

ctvdf <- ctvs %>% 
  unnest_longer(pkgs) %>% 
  left_join(select(db, Package, Author, Depends, Imports, Suggests), 
            by = c("pkgs" = "Package")) %>% 
  mutate(across(c(Depends, Imports, Suggests),
                ~str_split(.x, ", "))) %>% 
  mutate(across(c(Depends, Imports, Suggests),
                ~map(.x, function(apkg) str_extract(apkg, "^[A-Za-z0-9]+")))) %>%
  mutate(author_tidy = str_replace_all(Author, "\\s+", " "),
         author_tidy = str_replace_all(author_tidy, "<.*?>", ""),
         author_tidy = str_replace_all(author_tidy, "\\[.*?\\]", ""),
         author_tidy = str_replace_all(author_tidy, "\\(.*?\\)", ""),
         author_tidy = str_replace_all(author_tidy, "(&| and)", ","),
         author_tidy = str_replace_all(author_tidy, "\\(.*\\)", ""),
         author_tidy = str_replace_all(author_tidy, "\\.*$", ""),
         author_tidy = str_replace_all(author_tidy, ",,", ","),
         author_tidy = str_replace_all(author_tidy, " \\)", ""),
         author_tidy = str_replace_all(author_tidy, "\\s*,", ","),
         author_tidy = str_squish(author_tidy))


# words_to_delete <- c("Original by ",
#                      "Compiled by ",
#                      "is the sole author, creator of the BOOM project. Some code in the BOOM libraries has been modified from other open source projects. These include Cephes, NEWUOA, a modified version of the R math libraries . Original copyright notices have been maintained in all source files. In these cases, copyright claimed by Steven L. Scott is limited to modifications made to the original code. Google claims copyright for code written while Steven L. Scott was employed at Google from 2008 - 2018, but BOOM is not an officially supported Google project",
#                      " original C code for ARMS by ",
#                      "with contributions from ",
#                      "originally written by ",
#                      " changes, packaged by ",
#                      " With considerable contributions by ",
#                      " Ported to S-PLUS by ",
#                      "except dchud.f, dchdd.f, which were written by ",
#                      " with contributions from ",
#                      "based on Fortran code by")


ctvdf_sentences <- ctvdf %>%
  filter(str_detect(author_tidy, "riginal") | str_detect(author_tidy, " by ") | str_detect(author_tidy, "with") |
           str_detect(author_tidy, "under")| str_detect(author_tidy, "sole") | 
           str_detect(author_tidy,"written") | str_detect(author_tidy, "port") | str_detect(author_tidy, " work")|
           str_detect(author_tidy,"suggestion")|str_detect(author_tidy,"code"))


ctvdf_sentences_test <- ctvdf_sentences %>%
  mutate(author_tidy2 = person_entity(author_tidy)) %>%
  mutate(author_tidy3 = str_replace(author_tidy, "with contributions from", ","),
         author_tidy3 = str_replace(author_tidy, "Original by", ""))


ctvdf_with <- ctvdf %>%
  filter(str_detect(author_tidy, "with"))

# try to filter English words 

print(ctvdf_sentences$author_tidy)
```

